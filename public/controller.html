<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <script src="hammer.min.js"></script>
    <title>抖音遥控器</title>
    <style>
    html {
      height: 100%;
    }

    body {
      font-family: 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      height: 100%;
      margin: 0;
      background-color: #f0f0f0;
      user-select: none;
      overflow: hidden;
      touch-action: none;
      font-size: 12px;
      line-height: 1.25;
      padding: 15px;
      box-sizing: border-box;
    }

    .row {
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      justify-content: space-between;
    }

    .row:last-of-type {
      margin-bottom: 0;
    }

    .row .col {
      width: 31%;
    }

    .row .button {
      line-height: 1;
      width: 31%;
      display: flex;
      align-items: center;
      flex-direction: column;
      padding: 10px;
      border: none;
      border-radius: 8px;
      background-color: #2196F3;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s;
      outline: none;
      -webkit-tap-highlight-color: transparent;
      box-sizing: border-box;
    }

    .row .button:active {
      background-color: #0b7dda;
    }

    .row .button.green {
      background-color: #4CAF50;
    }

    .row .button.green:active {
      background-color: #45a049;
    }

    .row .button.green.no-active:active {
      background-color: #4CAF50;
    }

    .row .button.space {
      flex: 1;
    }

    .row .button .title {
      font-size: 12px;
      display: flex;
      align-items: flex-end;
      justify-content: center;
    }

    .row .button .subtitle {
      font-size: 10px;
      margin-left: 3px;
    }

    .row .button .desc {
      font-size: 10px;
    }

    .row .button .desc:empty {
      display: none;
    }

    .row .button .desc:not(:empty) {
      margin-top: 5px;
    }

    .hint {
      flex: 1;
      text-align: center;
      color: black;
      font-size: 10px;
      line-height: 1.25;
      border-radius: 8px;
      background: white;
      margin-top: 15px;
      border: 1px dashed grey;
      display: flex;
    }

    .hint .finger {
      box-sizing: border-box;
      padding-top: 10px;
      width: 50%;
      flex-shrink: 0;
    }

    .hint .mouse {
      box-sizing: border-box;
      padding-top: 10px;
      width: 50%;
      flex-shrink: 0;
      border-left: 1px dashed grey;
    }

    .reward-modal-mask {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      padding: 15px;
      box-sizing: border-box;
    }

    .reward-modal {
      background-color: white;
      border-radius: 12px;
      padding: 20px;
      width: 300px;
      text-align: center;
      position: relative;
    }

    .reward-modal .close-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      padding: 0;
      color: #666;
    }

    .reward-modal .close-btn:active {
      background-color: #999;
    }

    .reward-modal h3 {
      color: #333;
      margin: 18px 0;
      font-size: 18px;
    }

    .qrcode-container {
      margin: 10px 0 20px;
      padding: 10px;
      background-color: white;
      display: inline-block;
      border-radius: 8px;
      box-shadow: 0 0 2px rgba(0, 0, 0, 0.1);
    }

    .reward-qrcode {
      width: 200px;
      height: 276px;
      display: block;
    }

    .reward-desc {
      color: #333;
      margin: 10px 0;
      font-size: 14px;
      line-height: 1.5;
    }

    .reward-motivation {
      color: #666;
      font-size: 12px;
      margin-top: 15px;
      line-height: 1.5;
    }
    </style>
  </head>
  <body>
    <div class="controller">
      <div class="row">
        <div class="button" data-id="audio_mute">
          <span class="title">静音键</span>
          <span class="desc">静音</span>
        </div>
        <div class="button" data-id="audio_vol_down">
          <span class="title">音量-</span>
          <span class="desc">减小音量</span>
        </div>
        <div class="button" data-id="audio_vol_up">
          <span class="title">音量+</span>
          <span class="desc">增大音量</span>
        </div>
      </div>
      <div class="row">
        <div class="button" data-id="Ctrl + R">
          <span class="title">Ctrl + R</span>
          <span class="desc">刷新当前网页</span>
        </div>
        <div class="button" data-id="Ctrl + W">
          <span class="title">Ctrl + W</span>
          <span class="desc">关闭当前网页</span>
        </div>
        <div class="button" data-id="Ctrl + Shift + T">
          <span class="title">Ctrl + Shift + T</span>
          <span class="desc">打开被关闭的网页</span>
        </div>
      </div>
      <div class="row">
        <div class="button" data-id="j">
          <span class="title">J<span class="subtitle">抖音</span></span>
          <span class="desc">清屏/取消清屏</span>
        </div>
        <div class="button" data-id="Alt + F4">
          <span class="title">Alt + F4</span>
          <span class="desc">关闭当前应用</span>
        </div>
        <div class="button" data-id="Win + L">
          <span class="title">Win + L</span>
          <span class="desc">锁屏</span>
        </div>
      </div>
      <div class="row">
        <div class="button green" data-id="Open + douyin">
          <span class="title">打开<span class="subtitle">抖音</span></span>
          <span class="desc">打开网页版抖音</span>
        </div>
        <div class="button" data-id="k">
          <span class="title">K<span class="subtitle">抖音</span></span>
          <span class="desc">开启/取消自动连播</span>
        </div>
        <div class="button green no-active" data-id="rewardTheDeveloper">
          <span class="title">支持<span class="subtitle">开发者</span></span>
          <span class="desc">支持开发者</span>
        </div>
      </div>
      <div class="row">
        <div class="button" data-id="h">
          <span class="title">H<span class="subtitle">抖音</span></span>
          <span class="desc">开启/取消全屏</span>
        </div>
        <div class="button" data-id="f">
          <span class="title">F<span class="subtitle">抖音</span></span>
          <span class="desc">进入/退出作者主页</span>
        </div>
        <div class="button" data-id="g">
          <span class="title">G<span class="subtitle">抖音</span></span>
          <span class="desc">关注/取消关注作者</span>
        </div>
      </div>
      <div class="row">
        <div class="button" data-id="x">
          <span class="title">X<span class="subtitle">抖音</span></span>
          <span class="desc">打开/关闭评论</span>
        </div>
        <div class="button green" data-id="up">
          <span class="title">↑</span>
          <span class="desc">上一个视频</span>
        </div>
        <div class="button" data-id="z">
          <span class="title">Z<span class="subtitle">抖音</span></span>
          <span class="desc">点赞/取消点赞</span>
        </div>
      </div>
      <div class="row">
        <div class="button green" data-id="left">
          <span class="title">←</span>
          <span class="desc">快退</span>
        </div>
        <div class="button green" data-id="down">
          <span class="title">↓</span>
          <span class="desc">下一个视频</span>
        </div>
        <div class="button green" data-id="right">
          <span class="title">→</span>
          <span class="desc">快进</span>
        </div>
      </div>
      <div class="row">
        <div class="button space" data-id="space">
          <span class="title">Space<span class="subtitle">空格键</span></span>
          <span class="desc">播放/暂停视频</span>
        </div>
      </div>
    </div>
    <div class="hint">
      <div class="finger">
        <div><span>连接状态：</span><span class="connection-status">未连接</span></div>
        <div>可在此处区域 进行手势操控</div>
        <div>点击此处区域 等于按空格键</div>
        <div>使用手指上滑 会触发下键↓</div>
        <div>使用手指下滑 会触发上键↑</div>
        <div>使用手指左滑 会触发左键←</div>
        <div>使用手指右滑 会触发右键→</div>
      </div>
      <div class="mouse">
        <div><span>连接状态：</span><span class="connection-status">未连接</span></div>
        <div>可在此处区域 进行鼠标操控</div>
        <div>单击此处区域 等于鼠标左击</div>
        <div>双击此处区域 等于鼠标右击</div>
        <div>使用手指滑动 操控鼠标移动</div>
        <div>手指上下滑动 鼠标上下移动</div>
        <div>手指左右滑动 鼠标左右移动</div>
      </div>
    </div>
    <div class="reward-modal-mask" style="display: none;">
      <div class="reward-modal">
        <div class="close-btn">×</div>
        <h3>支持开发者</h3>
        <div class="qrcode-container">
          <img src="PayWeChat.jpg" alt="微信支付二维码" class="reward-qrcode">
        </div>
        <p class="reward-desc">使用微信扫码对开发者进行支持</p>
        <p class="reward-motivation">您的支持是开发者持续更新的动力</p>
      </div>
    </div>

    <script>
    class ClickHandler {
      constructor (element, options) {
        this.element = element
        this.options = {
          delay: 200,
          stopPropagation: true,
          ...options
        }
        this.clickTimer = null
        this.clickCount = 0
        this.bindEvents()
      }

      bindEvents () {
        this.element.addEventListener('click', (e) => this.handleClick(e))
        this.element.addEventListener('dblclick', (e) => {
          e.preventDefault()
          if (this.options.stopPropagation) {
            e.stopPropagation()
          }
        })
      }

      handleClick (e) {
        if (this.options.stopPropagation) {
          e.stopPropagation()
        }
        this.clickCount++
        if (this.clickCount === 1) {
          this.clickTimer = setTimeout(() => {
            if (this.clickCount === 1 && typeof this.options.onClick === 'function') {
              this.options.onClick(e)
            }
            this.resetState()
          }, this.options.delay)
        } else if (this.clickCount === 2) {
          clearTimeout(this.clickTimer)
          if (typeof this.options.onDblClick === 'function') {
            this.options.onDblClick(e)
          }
          this.resetState()
        }
      }

      resetState () {
        clearTimeout(this.clickTimer)
        this.clickTimer = null
        this.clickCount = 0
      }

      destroy () {
        this.resetState()
        this.element.removeEventListener('click', (e) => this.handleClick(e))
        this.element.removeEventListener('dblclick', (e) => e.preventDefault())
      }
    }

    // 获取当前页面的URL，用于WebSocket连接
    const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:'
    const wsHost = window.location.host
    const wsUrl = `${wsProtocol}//${wsHost}`

    // 连接WebSocket
    let ws

    function connect () {
      ws = new WebSocket(wsUrl)

      ws.onopen = () => {
        const connectionStatusAll = document.querySelectorAll('.connection-status')
        connectionStatusAll.forEach(status => {
          status.textContent = '已连接'
          status.style.color = 'green'
        })
      }

      ws.onclose = () => {
        const connectionStatusAll = document.querySelectorAll('.connection-status')
        connectionStatusAll.forEach(status => {
          status.textContent = '已断开'
          status.style.color = 'red'
        })
        // 尝试重连
        setTimeout(connect, 3000)
      }

      ws.onerror = (error) => {
        console.error('WebSocket错误:', error)
      }
    }

    // 支持开发者
    const rewardModal = document.querySelector('.reward-modal-mask')
    const closeBtn = document.querySelector('.reward-modal .close-btn')
    const hideRewardModal = () => (rewardModal.style.display = 'none')
    const showRewardModal = () => (rewardModal.style.display = 'flex')
    closeBtn.addEventListener('click', (e) => {
      e.stopPropagation()
      hideRewardModal()
    })
    rewardModal.addEventListener('click', (e) => {
      e.stopPropagation()
      if (e.target === rewardModal) hideRewardModal()
    })

    // 发送命令到服务器
    function sendCommand (command) {
      if (command === 'rewardTheDeveloper') {
        showRewardModal()
      } else if (ws && ws.readyState === WebSocket.OPEN) {
        ws.send(command)
      }
    }

    // 绑定按钮事件
    const arr = [...document.querySelectorAll('.controller .button')]
    arr.forEach(button => {
      button.addEventListener('click', (e) => {
        e.stopPropagation()
        const command = button.getAttribute('data-id')
        sendCommand(command)
      })
    })

    // 手势区域处理
    const fingerTrigger = (className) => {
      // 使用 Hammer.js 处理触摸滑动手势
      const gestureArea = document.querySelector(className)

      // 初始化 Hammer 实例
      const hammer = new Hammer(gestureArea)

      // 配置滑动识别器（可选：设置最小滑动距离）
      hammer.get('swipe').set({
        direction: Hammer.DIRECTION_ALL, // 允许所有方向的滑动
        threshold: 30, // 最小滑动距离（像素），防止误触
        velocity: 0.1 // 最小滑动速度
      })

      // 监听滑动事件
      hammer.on('swipe', (e) => {
        // 判断滑动方向
        switch (e.direction) {
          case Hammer.DIRECTION_UP:
            sendCommand('down')
            e.preventDefault()
            break
          case Hammer.DIRECTION_DOWN:
            sendCommand('up')
            e.preventDefault()
            break
          case Hammer.DIRECTION_LEFT:
            sendCommand('left')
            e.preventDefault()
            break
          case Hammer.DIRECTION_RIGHT:
            sendCommand('right')
            e.preventDefault()
            break
        }
      })
    }
    fingerTrigger('.finger')
    // 给.finger添加单击事件
    document.querySelector('.finger').addEventListener('click', (e) => {
      e.stopPropagation()
      sendCommand('space')
    })

    // 鼠标区域处理
    const mouseTrigger = (className) => {
      // 使用 Hammer.js 处理触摸滑动手势
      const gestureArea = document.querySelector(className)

      // 初始化 Hammer 实例
      const hammer = new Hammer(gestureArea)

      // 配置滑动识别器（可选：设置最小滑动距离）
      hammer.get('pan').set({
        direction: Hammer.DIRECTION_ALL, // 允许所有方向的滑动
        enable: true
      })

      // 监听滑动事件
      hammer.on('pan', (e) => sendCommand(JSON.stringify({ key: 'mousemove', velocityX: e.velocityX, velocityY: e.velocityY })))
    }
    mouseTrigger('.mouse')
    // 给.mouse添加单击事件/双击事件
    new ClickHandler(document.querySelector('.mouse'), {
      onClick: (e) => sendCommand('click'),
      onDblClick: (e) => sendCommand('dblclick')
    })

    // 初始化连接
    connect()
    </script>
  </body>
</html>
