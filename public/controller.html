<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <script src="hammer.min.js"></script>
    <title>键盘控制器</title>
    <style>
    html {
      height: 100%;
    }

    body {
      font-family: 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      height: 100%;
      margin: 0;
      background-color: #f0f0f0;
      user-select: none;
      overflow: hidden;
      font-size: 12px;
      line-height: 1.25;
      padding: 15px;
      box-sizing: border-box;
    }

    .row {
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      justify-content: space-between;
    }

    .row:last-of-type {
      margin-bottom: 0;
    }

    .row .col {
      width: 31%;
    }

    .row button {
      line-height: 1;
      width: 31%;
      display: flex;
      align-items: center;
      flex-direction: column;
      padding: 10px;
      border: none;
      border-radius: 8px;
      background-color: #2196F3;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .row button:active {
      background-color: #0b7dda;
    }

    .row button.green {
      background-color: #4CAF50;
    }

    .row button.green:active {
      background-color: #45a049;
    }

    .row button.space {
      flex: 1;
    }

    .row button .title {
      font-size: 12px;
      display: flex;
      align-items: flex-end;
      justify-content: center;
    }

    .row button .subtitle {
      font-size: 10px;
      margin-left: 3px;
    }

    .row button .desc {
      font-size: 10px;
    }

    .row button .desc:empty {
      display: none;
    }

    .row button .desc:not(:empty) {
      margin-top: 5px;
    }

    .hint {
      text-align: center;
      color: grey;
      font-size: 12px;
      line-height: 1.25;
      border-radius: 8px;
      padding: 10px;
      background: white;
      margin-top: 15px;
      border: 1px dashed grey;
    }

    .hint .status {
      color: black;
    }
    </style>
  </head>
  <body>
    <div class="controller">
      <div class="row">
        <button data-id="audio_mute">
          <span class="title">静音键</span>
          <span class="desc">静音</span>
        </button>
        <button data-id="audio_vol_down">
          <span class="title">音量-</span>
          <span class="desc">减小音量</span>
        </button>
        <button data-id="audio_vol_up">
          <span class="title">音量+</span>
          <span class="desc">增大音量</span>
        </button>
      </div>
      <div class="row">
        <button data-id="Ctrl + R">
          <span class="title">Ctrl + R</span>
          <span class="desc">刷新当前网页</span>
        </button>
        <button data-id="Ctrl + W">
          <span class="title">Ctrl + W</span>
          <span class="desc">关闭当前网页</span>
        </button>
        <button data-id="Ctrl + Shift + T">
          <span class="title">Ctrl + Shift + T</span>
          <span class="desc">打开被关闭的网页</span>
        </button>
      </div>
      <div class="row">
        <button data-id="Open + douyin" class="green">
          <span class="title">打开<span class="subtitle">抖音</span></span>
          <span class="desc">打开网页版抖音</span>
        </button>
        <button data-id="Alt + F4">
          <span class="title">Alt + F4</span>
          <span class="desc">关闭当前应用</span>
        </button>
        <button data-id="Win + L">
          <span class="title">Win + L</span>
          <span class="desc">锁屏</span>
        </button>
      </div>
      <div class="row">
        <button data-id="j">
          <span class="title">J<span class="subtitle">抖音</span></span>
          <span class="desc">清屏/取消清屏</span>
        </button>
        <button data-id="k">
          <span class="title">K<span class="subtitle">抖音</span></span>
          <span class="desc">开启/取消自动连播</span>
        </button>
        <button data-id="u">
          <span class="title">U<span class="subtitle">抖音</span></span>
          <span class="desc">开启/关闭小窗模式</span>
        </button>
      </div>
      <div class="row">
        <button data-id="h">
          <span class="title">H<span class="subtitle">抖音</span></span>
          <span class="desc">开启/取消全屏</span>
        </button>
        <button data-id="f">
          <span class="title">F<span class="subtitle">抖音</span></span>
          <span class="desc">进入/退出作者主页</span>
        </button>
        <button data-id="g">
          <span class="title">G<span class="subtitle">抖音</span></span>
          <span class="desc">关注/取消关注作者</span>
        </button>
      </div>
      <div class="row">
        <button data-id="x">
          <span class="title">X<span class="subtitle">抖音</span></span>
          <span class="desc">打开/关闭评论</span>
        </button>
        <button data-id="up" class="green">
          <span class="title">↑</span>
          <span class="desc">上一个视频</span>
        </button>
        <button data-id="z">
          <span class="title">Z<span class="subtitle">抖音</span></span>
          <span class="desc">点赞/取消点赞</span>
        </button>
      </div>
      <div class="row">
        <button data-id="left" class="green">
          <span class="title">←</span>
          <span class="desc">快退</span>
        </button>
        <button data-id="down" class="green">
          <span class="title">↓</span>
          <span class="desc">下一个视频</span>
        </button>
        <button data-id="right" class="green">
          <span class="title">→</span>
          <span class="desc">快进</span>
        </button>
      </div>
      <div class="row">
        <button data-id="space" class="space">
          <span class="title">Space<span class="subtitle">空格键</span></span>
          <span class="desc">播放/暂停视频</span>
        </button>
      </div>
    </div>
    <div class="hint">
      <div class="status"><span>连接状态：</span><span id="connection-status">未连接</span></div>
      <div>点击非按钮区域 等同于按空格键</div>
      <div>任意区域手指上滑 会触发下键↓</div>
      <div>任意区域手指下滑 会触发上键↑</div>
      <div>任意区域手指左滑 会触发左键←</div>
      <div>任意区域手指右滑 会触发右键→</div>
    </div>

    <script>
    // 获取当前页面的URL，用于WebSocket连接
    const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:'
    const wsHost = window.location.host
    const wsUrl = `${wsProtocol}//${wsHost}`

    // 连接WebSocket
    let ws

    function connect () {
      ws = new WebSocket(wsUrl)

      ws.onopen = () => {
        document.getElementById('connection-status').textContent = '已连接'
        document.getElementById('connection-status').style.color = 'green'
      }

      ws.onclose = () => {
        document.getElementById('connection-status').textContent = '已断开'
        document.getElementById('connection-status').style.color = 'red'
        // 尝试重连
        setTimeout(connect, 3000)
      }

      ws.onerror = (error) => {
        console.error('WebSocket错误:', error)
      }
    }

    // 发送命令到服务器
    function sendCommand (command) {
      if (ws && ws.readyState === WebSocket.OPEN) {
        ws.send(command)
      }
    }

    // 绑定按钮事件
    document.addEventListener('click', (e) => {
      e.stopPropagation()
      sendCommand('space')
    })
    const arr = [...document.querySelectorAll('.controller button')]
    arr.forEach(button => {
      button.addEventListener('click', (e) => {
        e.stopPropagation()
        const command = button.getAttribute('data-id')
        sendCommand(command)
      })
    })

    // 使用 Hammer.js 处理触摸滑动手势
    const gestureArea = document.querySelector('body')

    // 初始化 Hammer 实例
    const hammer = new Hammer(gestureArea)

    // 配置滑动识别器（可选：设置最小滑动距离）
    hammer.get('swipe').set({
      direction: Hammer.DIRECTION_ALL, // 允许所有方向的滑动
      threshold: 30, // 最小滑动距离（像素），防止误触
      velocity: 0.1 // 最小滑动速度
    })

    // 监听滑动事件
    hammer.on('swipe', (e) => {
      // 判断滑动方向
      switch (e.direction) {
        case Hammer.DIRECTION_UP:
          sendCommand('down')
          e.preventDefault()
          break
        case Hammer.DIRECTION_DOWN:
          sendCommand('up')
          e.preventDefault()
          break
        case Hammer.DIRECTION_LEFT:
          sendCommand('left')
          e.preventDefault()
          break
        case Hammer.DIRECTION_RIGHT:
          sendCommand('right')
          e.preventDefault()
          break
      }
    })

    // 初始化连接
    connect()
    </script>
  </body>
</html>
